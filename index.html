<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Christmas Contest 2025</title>
  <style>
    body {
      font-family: "Gotham", Arial, sans-serif;
      background: #f4f6f8;
      margin: 0;
      padding: 20px;
      color: #1e2447;
      text-align: center;
    }
    .email-input {
      margin-bottom: 20px;
    }
    .email-input input {
      padding: 10px;
      width: 280px;
      border-radius: 6px;
      border: 1px solid #ccc;
      font-size: 14px;
    }
    .email-input button {
      padding: 10px 20px;
      margin-left: 8px;
      border: none;
      border-radius: 6px;
      background: #1e2447;
      color: white;
      font-weight: bold;
      cursor: pointer;
    }
    .card {
      max-width: 480px;
      margin: 0 auto;
      background: white;
      border-radius: 16px;
      box-shadow: 0 8px 20px rgba(0,0,0,0.1);
      padding: 20px;
    }
    .header {
      background: #1e2447;
      color: white;
      padding: 20px;
      border-radius: 12px 12px 0 0;
    }
    .header h1 {
      margin: 0;
    }
    .divider {
      height: 1px;
      background: rgba(255,255,255,0.3);
      margin: 10px 0;
    }
    .circle {
      margin: 30px auto 10px auto;
      width: 200px;
      height: 200px;
      border-radius: 50%;
      border: 10px solid #f7c948;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      font-size: 18px;
      font-weight: bold;
      color: #1e2447;
      background: #fff;
      line-height: 1.4em;
    }
    .circle .reward {
      font-size: 22px;
      margin-top: 6px;
    }
    .stats {
      display: flex;
      justify-content: space-between;
      margin: 16px auto;
      max-width: 240px;
      font-size: 15px;
      font-weight: bold;
      color: #111;
    }
    .level-banner {
      background: #111;
      color: white;
      display: inline-block;
      padding: 8px 16px;
      border-radius: 20px;
      font-weight: bold;
      margin-top: 15px;
    }
    .progress {
      margin: 20px 0;
      height: 16px;
      background: #e6e8ef;
      border-radius: 10px;
      overflow: hidden;
      position: relative;
      box-shadow: inset 0 1px 3px rgba(0,0,0,0.12);
    }
    .progress-fill {
      height: 100%;
      width: 0%;
      background: linear-gradient(90deg, #1e2447, #3a4b91);
      transition: width 0.6s ease-in-out;
      border-radius: 10px 0 0 10px;
    }
    .footer {
      margin-top: 10px;
      font-size: 14px;
      color: #555;
    }
  </style>
</head>
<body>

<div class="email-input">
  <input id="email" type="email" placeholder="Enter your email">
  <button onclick="loadData()">View my widget</button>
</div>

<div class="card" id="widget" style="display:none;">
  <div class="header">
    <h1>Christmas Contest</h1>
    <div>20 Sep to 31 Dec (23:59 GMT)</div>
    <div class="divider"></div>
    <h2 id="currentLevel">YOU'RE ON LEVEL 0!</h2>
  </div>

  <div class="circle" id="rewardCircle">
    <div id="nextPoints">Next Level: 0 points</div>
    <div class="reward" id="nextReward">$0</div>
  </div>

  <div class="stats">
    <div id="units">Units: 0</div>
    <div id="currentPoints">Points: 0</div>
  </div>

  <div class="level-banner" id="nextLevel">LEVEL 1: 250 POINTS</div>

  <div class="progress">
    <div class="progress-fill" id="progressFill"></div>
  </div>
  <div id="progressText">0 / 250 (0%)</div>

  <div class="footer" id="userEmail"></div>
</div>

<script>
  const sheetUrl = "https://docs.google.com/spreadsheets/d/e/2PACX-1vRrR9NNEungPJAlTe2wiRwbacH7HChkkj_WpQuIKE-DQmMPpb8rJ1L3cNYeT63S4OOOoupb3cSCTXGS/pub?output=csv";

  const milestones = [
    { points: 250, reward: 50 },
    { points: 500, reward: 100 },
    { points: 1500, reward: 500 },
    { points: 2500, reward: 750 },
    { points: 5000, reward: 2000 },
    { points: 10000, reward: 5000 },
    { points: 25000, reward: 12500 },
    { points: 50000, reward: 25000 },
    { points: 100000, reward: 75000 },
    { points: 125000, reward: 100000 },
  ];

  async function loadData() {
    const email = document.getElementById("email").value.trim().toLowerCase();
    if (!email) return alert("Please enter your email!");

    const res = await fetch(sheetUrl);
    const text = await res.text();
    const rows = text.split("\n").map(r => r.split(","));
    
    const idx = rows.findIndex(r => r[0].trim().toLowerCase() === email);
    if (idx === -1) {
      alert("Email not found!");
      return;
    }

    const units = parseInt(rows[idx][3] || "0", 10);   // cột D
    const points = parseInt(rows[idx][4] || "0", 10);  // cột E

    document.getElementById("userEmail").innerText = "Email: " + email;
    document.getElementById("units").innerText = "Units: " + units.toLocaleString();
    document.getElementById("currentPoints").innerText = "Points: " + points.toLocaleString();

    let currentLevel = 0, nextMilestone = milestones[0];
    for (let i = 0; i < milestones.length; i++) {
      if (points >= milestones[i].points) {
        currentLevel = i + 1;
        nextMilestone = milestones[i + 1] || milestones[i];
      } else {
        nextMilestone = milestones[i];
        break;
      }
    }

    document.getElementById("currentLevel").innerText = `YOU'RE ON LEVEL ${currentLevel}!`;
    document.getElementById("nextPoints").innerText = `Next Level: ${nextMilestone.points.toLocaleString()} points`;
    document.getElementById("nextReward").innerText = `$${nextMilestone.reward.toLocaleString()}`;
    document.getElementById("nextLevel").innerText = `LEVEL ${currentLevel+1}: ${nextMilestone.points.toLocaleString()} POINTS`;

    const progress = Math.min((points / nextMilestone.points) * 100, 100);
    document.getElementById("progressFill").style.width = progress + "%";
    document.getElementById("progressText").innerText = `${points.toLocaleString()} / ${nextMilestone.points.toLocaleString()} (${progress.toFixed(0)}%)`;

    document.getElementById("widget").style.display = "block";
  }
</script>

</body>
</html>
