<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Christmas Contest 2025</title>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Montserrat', sans-serif;
      background: #f7f7fa;
      margin: 0;
      color: #1e2447;
    }
    .container {
      max-width: 480px;
      background: #fff;
      margin: 40px auto;
      border-radius: 12px;
      box-shadow: 0 10px 25px rgba(0,0,0,0.1);
      overflow: hidden;
    }
    header {
      background: #1e2447;
      color: white;
      text-align: center;
      padding: 32px 16px;
    }
    header h1 {
      font-size: 26px;
      margin: 0;
    }
    header p {
      margin: 6px 0;
      font-size: 15px;
    }
    header hr {
      width: 50%;
      border: 0;
      height: 1px;
      background: #fff;
      margin: 12px auto;
      opacity: 0.3;
    }
    .level {
      font-weight: 700;
      font-size: 22px;
      margin-top: 8px;
    }
    .email-form {
      text-align: center;
      padding: 28px 16px;
    }
    .email-form input {
      width: 75%;
      padding: 10px;
      font-size: 15px;
      border-radius: 8px;
      border: 1px solid #ccc;
    }
    .email-form button {
      background: #1e2447;
      color: #fff;
      font-weight: 600;
      border: none;
      border-radius: 8px;
      padding: 10px 20px;
      margin-left: 8px;
      cursor: pointer;
    }
    .widget {
      padding: 24px;
      display: none;
    }
    .circle {
      width: 200px;
      height: 200px;
      border-radius: 50%;
      border: 10px solid #f5c84c;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      margin: 0 auto 24px auto;
    }
    .circle p {
      margin: 4px 0;
      text-align: center;
    }
    .units-points {
      display: flex;
      justify-content: space-between;
      font-weight: 700;
      font-size: 16px;
      margin-bottom: 12px;
    }
    .progress-container {
      position: relative;
      height: 24px;
      background: #ddd;
      border-radius: 12px;
      overflow: hidden;
    }
    .progress-bar {
      background: linear-gradient(90deg, #1e2447, #37467b);
      height: 100%;
      width: 0%;
      border-radius: 12px;
      text-align: right;
      color: #fff;
      font-weight: 700;
      font-size: 14px;
      padding-right: 10px;
      transition: width 0.6s ease;
    }
    .progress-info {
      display: flex;
      justify-content: space-between;
      font-size: 14px;
      color: gray;
      margin-top: 4px;
    }
    .clock {
      color: #c0392b;
    }
    footer {
      text-align: center;
      color: gray;
      font-size: 14px;
      margin-top: 18px;
    }
  </style>
</head>
<body>

<div class="container">
  <div class="email-form" id="emailForm">
    <input type="email" id="emailInput" placeholder="Enter your email (example@domain.com)" />
    <button onclick="fetchData()">View my widget</button>
  </div>

  <div id="widget" class="widget">
    <header>
      <h1>Christmas Contest</h1>
      <p>20 Sep to 31 Dec (23:59 GMT)</p>
      <hr />
      <div class="level" id="levelText">YOU'RE ON LEVEL 0!</div>
    </header>

    <div class="circle">
      <p style="font-size:14px;">Unlock Next Level</p>
      <p id="nextPoints" style="font-size:22px; font-weight:700;">250 Points</p>
      <p id="nextReward" style="font-size:16px;">$50</p>
    </div>

    <div class="units-points">
      <div id="unitsText">Units: 0</div>
      <div id="pointsText">Points: 0</div>
    </div>

    <div class="progress-container">
      <div class="progress-bar" id="progressBar">0%</div>
    </div>

    <div class="progress-info">
      <div id="progressLabel">0 / 250 Points</div>
      <div><span class="clock">‚è∞</span> <span id="daysLeft"></span> days left</div>
    </div>

    <footer>Email: <span id="emailDisplay"></span></footer>
  </div>
</div>

<script>
const SHEET_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vRrR9NNEungPJAlTe2wiRwbacH7HChkkj_WpQuIKE-DQmMPpb8rJ1L3cNYeT63S4OOOoupb3cSCTXGS/pub?output=csv";

const levels = [
  { points: 250, reward: 50 },
  { points: 500, reward: 100 },
  { points: 1500, reward: 500 },
  { points: 2500, reward: 750 },
  { points: 5000, reward: 2000 },
  { points: 10000, reward: 5000 },
  { points: 25000, reward: 12500 },
  { points: 50000, reward: 25000 },
  { points: 100000, reward: 75000 },
  { points: 125000, reward: 100000 }
];

async function fetchData() {
  const email = document.getElementById("emailInput").value.trim().toLowerCase();
  if (!email) return alert("Please enter your email!");

  try {
    const res = await fetch(SHEET_URL);
    const text = await res.text();
    const rows = text.split("\n").map(r => r.split(","));
    const headers = rows[0].map(h => h.trim().toLowerCase());
    const emailIndex = headers.indexOf("email");
    const pointsIndex = headers.indexOf("points");
    const unitsIndex = headers.indexOf("units");

    const user = rows.find(r => r[emailIndex]?.trim().toLowerCase() === email);
    if (!user) {
      alert("Email not found!");
      return;
    }

    const points = parseInt(user[pointsIndex]) || 0;
    const units = parseInt(user[unitsIndex]) || 0;

    displayWidget(email, points, units);
  } catch (err) {
    alert("Unable to load data. Please try again later.");
    console.error(err);
  }
}

function displayWidget(email, points, units) {
  document.getElementById("emailForm").style.display = "none";
  document.getElementById("widget").style.display = "block";

  const next = levels.find(l => points < l.points) || levels[levels.length - 1];
  const prev = [...levels].reverse().find(l => points >= l.points) || { points: 0 };

  const progress = Math.min(100, ((points - prev.points) / (next.points - prev.points)) * 100).toFixed(1);
  const daysLeft = Math.max(0, Math.ceil((new Date("2025-12-31T23:59:00Z") - new Date()) / (1000 * 60 * 60 * 24)));

  document.getElementById("levelText").textContent = `YOU'RE ON LEVEL ${levels.indexOf(prev) + 1}!`;
  document.getElementById("nextPoints").textContent = `${next.points} Points`;
  document.getElementById("nextReward").textContent = `$${next.reward}`;
  document.getElementById("unitsText").textContent = `Units: ${units}`;
  document.getElementById("pointsText").textContent = `Points: ${points}`;
  document.getElementById("progressLabel").textContent = `${points} / ${next.points} Points`;
  document.getElementById("daysLeft").textContent = daysLeft;
  document.getElementById("emailDisplay").textContent = email;

  const progressBar = document.getElementById("progressBar");
  progressBar.style.width = `${progress}%`;
  progressBar.textContent = `${progress}%`;
}
</script>

</body>
</html>
