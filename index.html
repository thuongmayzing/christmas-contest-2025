<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Christmas Contest 2025</title>
  <style>
    /* Load Gotham font from local folder */
    @font-face {
      font-family: 'Gotham';
      src: url('fonts/GothamHTF-Light.otf') format('opentype');
      font-weight: 300;
    }
    @font-face {
      font-family: 'Gotham';
      src: url('fonts/GothamHTF-Book.otf') format('opentype');
      font-weight: 400;
    }
    @font-face {
      font-family: 'Gotham';
      src: url('fonts/GothamHTF-Medium.otf') format('opentype');
      font-weight: 500;
    }
    @font-face {
      font-family: 'Gotham';
      src: url('fonts/GothamHTF-Bold.otf') format('opentype');
      font-weight: 700;
    }
    @font-face {
      font-family: 'Gotham';
      src: url('fonts/GothamHTF-Black.otf') format('opentype');
      font-weight: 900;
    }

    body {
      font-family: 'Gotham', sans-serif;
      background: #f5f6fa;
      margin: 0;
      padding: 0;
      display: flex;
      justify-content: center;
      align-items: flex-start;
    }

    .container {
      width: 100%;
      max-width: 600px;
      background: white;
      border-radius: 14px;
      box-shadow: 0 6px 20px rgba(0,0,0,0.08);
      margin: 20px;
      padding-bottom: 20px;
      overflow: hidden;
    }

    .header {
      background: #1e2447;
      color: white;
      text-align: center;
      padding: 40px 20px;
      border-bottom-left-radius: 20px;
      border-bottom-right-radius: 20px;
    }

    .header h1 {
      font-size: 26px;
      margin: 0;
      font-weight: 700;
    }

    .header p {
      font-size: 16px;
      margin: 6px 0 12px;
      opacity: 0.9;
    }

    .divider {
      width: 50%;
      margin: 10px auto;
      border-top: 2px solid rgba(255,255,255,0.3);
    }

    .level-text {
      font-size: 22px;
      font-weight: 700;
      margin-top: 10px;
    }

    .email-box {
      text-align: center;
      margin: 20px 0;
    }

    .email-box input {
      width: 70%;
      padding: 10px;
      border: 1px solid #ccc;
      border-radius: 6px;
      font-size: 15px;
      font-family: 'Gotham', sans-serif;
    }

    .email-box button {
      background: #1e2447;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 6px;
      font-size: 15px;
      margin-left: 10px;
      cursor: pointer;
      font-family: 'Gotham', sans-serif;
    }

    .circle {
      width: 200px;
      height: 200px;
      border: 8px solid #f7c948;
      border-radius: 50%;
      margin: 30px auto 20px;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      text-align: center;
    }

    .circle .small {
      font-size: 14px;
      color: #333;
      margin-bottom: 4px;
    }

    .circle .big {
      font-size: 24px;
      font-weight: 700;
      color: #1e2447;
    }

    .circle .reward {
      font-size: 14px;
      color: #444;
      margin-top: 4px;
    }

    .stats {
      display: flex;
      justify-content: space-around;
      margin: 15px 0;
      font-size: 16px;
      font-weight: 700;
      color: #1e2447;
    }

    .progress-container {
      margin: 10px 25px;
    }

    .progress {
      height: 20px;
      border-radius: 10px;
      background: #ddd;
      position: relative;
    }

    .progress-bar {
      height: 100%;
      border-radius: 10px;
      background: linear-gradient(90deg, #1e2447, #3c4a90);
      width: 0%;
    }

    .progress-text {
      text-align: left;
      font-size: 14px;
      margin-top: 6px;
      color: gray;
      display: flex;
      justify-content: space-between;
    }

    .email-footer {
      text-align: center;
      font-size: 14px;
      color: #555;
      margin-top: 10px;
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- Email nhập -->
    <div class="email-box">
      <input type="email" id="emailInput" placeholder="Enter your email (example@domain.com)">
      <button onclick="loadData()">View my widget</button>
    </div>

    <!-- Header -->
    <div class="header">
      <h1>Christmas Contest</h1>
      <p>20 Sep to 31 Dec (23:59 GMT)</p>
      <div class="divider"></div>
      <div class="level-text" id="levelText">YOU'RE ON LEVEL 0!</div>
    </div>

    <!-- Circle -->
    <div class="circle">
      <div class="small">Unlock Next Level</div>
      <div class="big" id="nextPoints">0 Points</div>
      <div class="reward" id="nextReward">$0</div>
    </div>

    <!-- Stats -->
    <div class="stats">
      <div id="units">Units: 0</div>
      <div id="points">Points: 0</div>
    </div>

    <!-- Progress bar -->
    <div class="progress-container">
      <div class="progress">
        <div class="progress-bar" id="progressBar"></div>
      </div>
      <div class="progress-text">
        <span id="progressText">Progress: 0%</span>
        <span id="timeLeft">⏰ 0 days left</span>
      </div>
    </div>

    <div class="email-footer" id="emailFooter">Email: -</div>
  </div>

  <script>
    const milestones = [
      { level: 1, points: 250, bonus: 50 },
      { level: 2, points: 500, bonus: 100 },
      { level: 3, points: 1500, bonus: 500 },
      { level: 4, points: 2500, bonus: 750 },
      { level: 5, points: 5000, bonus: 2000 },
      { level: 6, points: 10000, bonus: 5000 },
      { level: 7, points: 25000, bonus: 12500 },
      { level: 8, points: 50000, bonus: 25000 },
      { level: 9, points: 100000, bonus: 75000 },
      { level: 10, points: 125000, bonus: 100000 }
    ];

    function loadData() {
      const email = document.getElementById("emailInput").value.trim();
      if (!email) return alert("Please enter your email!");

      document.getElementById("emailFooter").innerText = "Email: " + email;

      // CSV link từ Google Sheets
      const sheetUrl = "https://docs.google.com/spreadsheets/d/e/2PACX-1vRrR9NNEungPJAlTe2wiRwbacH7HChkkj_WpQuIKE-DQmMPpb8rJ1L3cNYeT63S4OOOoupb3cSCTXGS/pub?output=csv";

      fetch(sheetUrl)
        .then(res => res.text())
        .then(csv => {
          const rows = csv.split("\n").map(r => r.split(","));
          const headers = rows[0];
          const emailIndex = headers.indexOf("Email");
          const unitsIndex = headers.indexOf("Units");
          const pointsIndex = headers.indexOf("Points");

          const userRow = rows.find(r => r[emailIndex] && r[emailIndex].trim() === email);
          if (!userRow) {
            alert("Email not found in contest data!");
            return;
          }

          const units = parseInt(userRow[unitsIndex] || "0");
          const points = parseInt(userRow[pointsIndex] || "0");

          document.getElementById("units").innerText = "Units: " + units;
          document.getElementById("points").innerText = "Points: " + points;

          // xác định level hiện tại
          let currentLevel = 0;
          let nextMilestone = milestones[0];
          for (let i = 0; i < milestones.length; i++) {
            if (points >= milestones[i].points) {
              currentLevel = milestones[i].level;
              nextMilestone = milestones[i + 1] || milestones[i];
            }
          }

          document.getElementById("levelText").innerText = `YOU'RE ON LEVEL ${currentLevel}!`;
          document.getElementById("nextPoints").innerText = `${nextMilestone.points} Points`;
          document.getElementById("nextReward").innerText = `$${nextMilestone.bonus}`;

          // progress
          const progress = Math.min((points / nextMilestone.points) * 100, 100);
          document.getElementById("progressBar").style.width = progress + "%";
          document.getElementById("progressText").innerText = `Progress: ${progress.toFixed(1)}%`;

          // thời gian còn lại
          const contestEnd = new Date("2025-12-31T23:59:59Z");
          const now = new Date();
          const diffDays = Math.ceil((contestEnd - now) / (1000 * 60 * 60 * 24));
          document.getElementById("timeLeft").innerText = `⏰ ${diffDays} days left`;
        })
        .catch(err => {
          console.error(err);
          alert("Unable to load data. Please try again later.");
        });
    }
  </script>
</body>
</html>
