<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Christmas Contest 2025</title>
  <style>
    body {font-family: Inter, sans-serif; background:#f6f7fb; margin:0; padding:0; color:#111827;}
    .container {max-width:600px; margin:40px auto; padding:20px; background:#fff; border-radius:12px; box-shadow:0 8px 20px rgba(0,0,0,0.1);}
    .login {text-align:center; margin-bottom:20px;}
    .login input {padding:10px; width:70%; border:1px solid #ccc; border-radius:6px;}
    .login button {padding:10px 16px; margin-left:10px; border:none; border-radius:6px; background:#111827; color:#fff; cursor:pointer;}
    .campaign {font-size:20px; font-weight:600; text-align:center; margin-bottom:10px;}
    .dates {text-align:center; font-size:14px; color:#555; margin-bottom:30px;}
    .badge-circle {width:180px; height:180px; border-radius:50%; background:#ffd966; display:flex; align-items:center; justify-content:center; margin:0 auto;}
    .badge-inner {background:#fff; border-radius:50%; width:140px; height:140px; display:flex; align-items:center; justify-content:center; flex-direction:column;}
    .badge-level {font-size:22px; font-weight:700;}
    .progress-wrap {width:100%; margin:20px auto; text-align:center;}
    .progress-bar {background:#eee; border-radius:10px; height:16px; overflow:hidden;}
    .progress-fill {background:linear-gradient(90deg,#ff6f61,#fcb045); height:100%; width:0%;}
    .next-reward {margin-top:12px; font-weight:600;}
    .email-display {margin-top:8px; font-size:14px; color:#888;}
  </style>
</head>
<body>
  <div class="container">
    <div class="login">
      <label>Enter your email to view your Christmas Contest progress</label><br><br>
      <input type="email" id="emailInput" placeholder="you@example.com"/>
      <button id="viewWidget">View my widget</button>
    </div>

    <div id="widget" style="display:none;">
      <div class="campaign">Christmas Contest 2025</div>
      <div class="dates">20 September – 31 December 2025 (23:59 GMT)</div>
      <div class="badge-circle">
        <div class="badge-inner">
          <div style="font-size:14px; color:#555;">NEXT</div>
          <div class="badge-level" id="nextLevel">LEVEL</div>
          <div id="nextTarget"></div>
        </div>
      </div>
      <div class="next-reward" id="nextReward"></div>
      <div class="progress-wrap">
        <div id="progressText"></div>
        <div class="progress-bar"><div class="progress-fill" id="progressFill"></div></div>
      </div>
      <div class="email-display" id="userEmail"></div>
    </div>
  </div>

<script>
const sheetUrl = "https://docs.google.com/spreadsheets/d/e/2PACX-1vRrR9NNEungPJAlTe2wiRwbacH7HChkkj_WpQuIKE-DQmMPpb8rJ1L3cNYeT63S4OOOoupb3cSCTXGS/pub?output=csv";

// milestones (points → reward)
const milestones = [
  {points:250, reward:"$50"},
  {points:500, reward:"$100"},
  {points:1500, reward:"$500"},
  {points:2500, reward:"$750"},
  {points:5000, reward:"$2000"},
  {points:10000, reward:"$5000"},
  {points:25000, reward:"$12500"},
  {points:50000, reward:"$25000"},
  {points:100000, reward:"$75000"},
  {points:125000, reward:"$100000"}
];

document.getElementById("viewWidget").addEventListener("click", function() {
  const email = document.getElementById("emailInput").value.trim();
  if (!email) {
    alert("Please enter your email!");
    return;
  }
  loadUserData(email);
});

async function loadUserData(email) {
  try {
    const res = await fetch(sheetUrl);
    const text = await res.text();
    const rows = text.split("\n").map(r => r.split(","));
    const headers = rows[0];
    const emailIndex = headers.indexOf("Email");
    const pointsIndex = headers.indexOf("Total Points");

    const userRow = rows.find(r => r[emailIndex] && r[emailIndex].trim() === email);
    if (!userRow) {
      alert("Email not found in contest data.");
      return;
    }

    const points = parseInt(userRow[pointsIndex]) || 0;
    renderWidget(email, points);
  } catch (e) {
    alert("Error loading data: " + e);
  }
}

function renderWidget(email, points) {
  document.querySelector(".login").style.display = "none";
  const widget = document.getElementById("widget");
  widget.style.display = "block";

  document.getElementById("userEmail").textContent = "Email: " + email;

  // find current and next milestone
  let current = {points:0, reward:""};
  let next = null;
  for (let m of milestones) {
    if (points >= m.points) {
      current = m;
    } else {
      next = m;
      break;
    }
  }
  if (!next) {
    next = milestones[milestones.length-1];
  }

  document.getElementById("nextLevel").textContent = "LEVEL " + next.points.toLocaleString();
  document.getElementById("nextTarget").textContent = next.points + " POINTS";
  document.getElementById("nextReward").textContent = "Next reward: " + next.reward;

  const progressPercent = Math.min(100, (points / next.points) * 100).toFixed(1);
  document.getElementById("progressText").textContent = points + " / " + next.points + " (" + progressPercent + "%)";
  document.getElementById("progressFill").style.width = progressPercent + "%";
}
</script>
</body>
</html>
